{{ template "layout_main.html" .}}

{{ block "header".}}
{{end}}

{{ block "content" .}}
<div class="row m-3 mb-5">

</div>
<div class="row">
    <div class="col-12">
        <table id="configureTable" class="display" style="width:100%">
            <thead>
            <tr>
                <th>ID</th>
                <th>Parent</th>
                <th>Name</th>
                <th>Value</th>
                <th>DataType</th>
                <th>Private</th>
                <th>Create</th>
                <th>Describe</th>
            </tr>
            </thead>
            <tbody>
            {{ range $index, $node := .data}}
            <tr>
                <td>{{$node.ID}}</td>
                <td>{{$node.SubName}}</td>
                <td>{{$node.Name}}</td>
                <td>{{$node.Value}}</td>
                <td>{{$node.DataType}}</td>
                <td>{{$node.Private}}</td>
                <td>{{$node.CreateTime}}</td>
                <td>{{$node.Describe}}</td>
            </tr>
            {{end}}
            </tbody>
        </table>
    </div>
</div>


{{end}}

{{block "script" .}}

<script>
    $(document).ready(function () {
        let table = new DataTable('#configureTable', {
            columnDefs: [{
                // The `data` parameter refers to the data for the cell (defined by the
                // `data` option, which defaults to the column being worked with, in
                // this case `data: 0`.
                render: function (data, type, row) {
                    if (data === "0") {
                        return "string"
                    } else if (data === "1") {
                        return "int"
                    } else if (data === "2") {
                        return "float"
                    } else if (data === "3") {
                        return "bool"
                    } else if (data === "4") {
                        return "null"
                    } else if (data === "5") {
                        return "child"
                    } else {
                        return "unknown"
                    }
                },
                targets: 4
            }, {
                fnCreatedCell: function (cell, cellData, rowData, rowIndex, colIndex) {
                    let trow = null;
                    $(cell).click(function () {
                        $(this).html('<input type="text" value="请输入" size="16" style="width: 100%"/>');
                        let aInput = $(this).find(":input");
                        aInput.focus().val(cellData);
                        trow = table.row($(this)).data();
                    });
                    $(cell).on("blur", ":input", function () {
                        let text = $(this).val();
                        $(cell).html(text);
                        table.cell(cell).data(text);
                        console.info("当前修改行:" + JSON.stringify(trow));
                        let id = rowData[0]
                        $.ajax({
                            type: "POST",
                            url: "/configure/node/"+id,
                            data: JSON.stringify({
                                value: rowData[3],
                                describe: rowData[7]
                            }),
                            contentType: 'application/json',
                            success: function (data) {
                                if (!data.success) {
                                    alert(data.error)
                                }
                            },
                            error: function (xhr, status, error) {
                                showMsg("Request failed:" + error)
                            }
                        })
                    });
                },
                targets: [3, 7],
            }]
        });
    })
</script>
{{end}}